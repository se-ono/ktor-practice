# ğŸ§± ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¸
FROM gradle:8.4-jdk17 AS builder

WORKDIR /app

# Gradleå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ˆã«ã‚³ãƒ”ãƒ¼ï¼ˆãƒ‘ã‚¹ä¿®æ­£æ¸ˆï¼‰
COPY app/build.gradle.kts app/settings.gradle.kts ./
COPY app/gradle ./gradle
COPY app/gradle.properties ./
COPY app/gradlew ./
COPY app/gradlew.bat ./

# ä¾å­˜è§£æ±º
RUN ./gradlew dependencies --no-daemon

#
COPY app/ ./

# å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰
RUN ./gradlew installDist --no-daemon


# ğŸš€ å®Ÿè¡Œã‚¹ãƒ†ãƒ¼ã‚¸
FROM openjdk:17-slim

WORKDIR /app

COPY --from=builder /app/build/install/ktor-practice/ .

EXPOSE 8080

CMD ["bin/ktor-practice"]
